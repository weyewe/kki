
<div class="span9 content">
  <%= create_guide("Group Loan Setup", 
        "Setup group loan for office: <b>#{@office.name}</b>" + "<br />" + 
        "Total  Member: <b>#{@group_loan_memberships.count}</b> " + "<br />"+ 
        "Lokasi: <b>#{@group_loan.get_commune}</b>").html_safe %>
  
  <%#= create_breadcrumb(@breadcrumbs).html_safe %>
  
  
  <!-- <div class="alert alert-info" style="text-align:center;">
    <a data-dismiss="alert" class="close">×</a>
    <strong>Hello!!</strong> Anda (loan officer) harus mengumpulkan biaya setup untuk Group Loan. <br />
    Adapun komponen biaya setup itu adalah: <strong>Admin Fee</strong>, 
    <strong>Tabungan Awal</strong>, dan <strong>Deposito</strong>. <br />
    Jika <strong>semua member</strong> telah membayar biaya setup, maka click tombol berikut ini:
    <br >
    <p style="text-align:center; margin-top:30px;">
    <button href="#" class="btn btn-primary">Finalize Setup</button>
    </p>
  </div>
         -->
        
  
   
  <div class="row-fluid">
    <div id="data_list">
      <table cellpadding="0" cellspacing="0" border="0" 
            class="table table-striped table-bordered" id="example">
        <thead>
          <tr>
            <th>Nama</th>
            <th>Admin Fee</th>
            <th>Initial Saving</th>
            <th>Deposit</th>
            <th style="text-align:center;" colspan="2">Action</th> 
            
          </tr>
        </thead>
        <tbody>
          <% @group_loan_memberships.each do |group_loan_membership| %>
            <%= render :partial => "group_loan_memberships/setup_payment", 
                    :locals => {:group_loan_membership => group_loan_membership }%>
          <% end %>
       
        </tbody>
      </table>
      
    </div><!-- end of #data_list -->
  </div>
  
  <div class=" hidden" id="data_form_wrapper">
    
  </div>
  
  
</div><!--/span-->


<div class="modal" id="myModal" style="display:none;">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3></h3>
  </div>
  <div class="modal-body">
    <table cellpadding="0" cellspacing="0" border="0" 
          class=" table table-striped table-bordered" >
      <thead>
        <tr>
          <th colspan="2">Payment Details</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Admin Fee</td>

          <td>
            <span class="input-xlarge uneditable-input" id="admin_fee_uneditable">Some value here</span>
            <%= hidden_field_tag 'admin_fee', '' %>
          </td>
          <td></td>
        </tr>
        <tr>
          <td>Initial Savings</td>
          <td><%= text_field_tag 'initial_savings', '' %></td>
        </tr>

        <tr>
          <td>Deposit</td>
          <td><%= text_field_tag 'deposit', '' %></td>
        </tr>

        <!-- <tr>
               <td><b>Total</b></td>
               <td><b id="total_setup_payment">0</b></td>
             </tr> -->

      </tbody>
    </table>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn modal-closer">Close</a>
    <!-- <a href="#" class="btn btn-primary">Save changes</a> -->
  </div>
</div>


<div class="hidden" id="form_setup_payment_wrapper">
  
  
  
</div>
 
 

<% content_for :additional_js  do %>
  <script type="text/javascript">
    $(document).ready(function(){
      $(".setup_payment").live('click', function(){
        var $this = $(this);
        var $row_wrapper = $this.parents("tr");
        var row_id_prefix = $row_wrapper.attr("id").split("-")[0];
        var current_row_id = $row_wrapper.attr("id").split("-")[1];
        
        var $modal_wrapper = $("#myModal"); 
        var $header = $(".modal-header h3", $modal_wrapper);
        var $body  = $(".modal-body", $modal_wrapper);
        var $modal_closer = $(".modal-footer .modal-closer ", $modal_wrapper);
        
        
        
        var member_name =  $(".member_name", $row_wrapper).text()  ;
        var admin_fee = parseInt( $(".admin_fee", $row_wrapper).attr("value") );
        var min_initial_savings = parseInt(  $(".initial_savings" , $row_wrapper).attr("value") );
        
        var header_html = "Setup Payment for <b>"+ member_name + "</b>";
        $("#admin_fee").attr('value', admin_fee);
        $("#initial_savings").attr("value", min_initial_savings);
        $("#admin_fee_uneditable").text( admin_fee );
        
        var total = admin_fee + initial_savings;
        $("#total_setup_payment").text( total );
        
       
        

        $modal_wrapper.modal("show");
        
        // $("#initial_savings, #deposit").live("change",function(){
        //          // recalculate the price 
        //        });
        //        

        $modal_closer.click(function(){
          // validations 
          // check the value of the initial savings.. bigger than the min?
          // then check the value of deposit. if ==0 , ask are you sure? 
          $modal_wrapper.modal('hide');
          $("#deposit").attr("value", '' );
        });

        
        
        
        
        return false;
        
        
        
      });
    });
  </script>
<% end %>















